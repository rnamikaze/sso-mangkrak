import{r as l,j as e}from"./app-BRf5toWG.js";import{d as q,f as w,I as x,J as M,K as A,L as Q}from"./index-BhJBT7_l.js";import{F as i}from"./index.es-BtTm-lQZ.js";import C from"./UniversalLoading-2zv7oq6L.js";import{F as n}from"./flex-DKwlgr-O.js";import{H as y}from"./heading-D-CUm6-X.js";import{B as m}from"./button-Dm7yfw5z.js";import{T as D,a as N,b as o,c as E}from"./thead-jL1IYPIh.js";import{T as B,a as p}from"./tr-D0gvPZIT.js";import{T as a}from"./td-6W2IKI22.js";import"./circular-progress-By2wHYQi.js";import"./use-merge-refs-CHqHjQ4S.js";import"./attr-sHTFgF0E.js";function X(d){return d.replace(/[^a-zA-Z0-9]/,"")}function $(d,f,u){return u>=d.length||f>u?"Invalid indices provided":d.slice(0,f).concat(d.slice(u+1))}const me=({setCurrentView:d})=>{const[f,u]=l.useState(!1),[h,H]=l.useState([]),[j,I]=l.useState(null),[L,R]=l.useState("Tunggu..."),[g,V]=l.useState([]),[b,W]=l.useState(!1),[Y,S]=l.useState(!1),K=()=>{W(s=>!s)},P=async()=>{S(!0);const s=new FormData;s.append("excel_file",j);try{const r=await axios.post("/sik/up-import-presensi-admin",s,{headers:{"Content-Type":"multipart/form-data"}});G(r.data.import[0][1],r.data.import[0]),u(!0),S(!1)}catch(r){console.error("Error uploading file:",r)}},G=(s,r)=>{const c=[];let t=null;$(r,0,1).forEach(U=>{t={};let z=!1;U.forEach((O,Z)=>{U[2]!==null&&(t[s[Z]]=O,z=!0)}),z&&c.push(t)}),V(c)},[k,J]=l.useState([]),[F,T]=l.useState(!1),_=()=>{T(!0),axios.post("/sik/save-import-presensi-admin",{data:g}).then(function(s){s.data.good?(T(!1),alert("Disimpan")):alert("Gagal")}).catch(function(s){})};return l.useEffect(()=>{if(h.length>0){let s=[];for(let r=0;r<h.length;r++){let c=h[r];c.renew=!1;let t=g.find(v=>X(v.rn_nik)==h[r].nik);t?(c.renew=!0,c.absensi_new={hadir:t.rn_abs_hadir===null?0:t.rn_abs_hadir,terlambat:t.rn_abs_terlambat===null?0:t.rn_abs_terlambat,tidak_hadir:t.rn_abs_tidak_hadir===null?0:t.rn_abs_tidak_hadir}):c.absensi_new={hadir:0,terlambat:0,tidak_hadir:0},s.push(c)}J(s)}},[h,g]),l.useEffect(()=>{axios.post("/sik/get-all-absensi-value",{by:"@rnamikaze"}).then(function(s){H(s.data.absensi),R(s.data.lastUpload)}).catch(function(s){})},[]),e.jsx(e.Fragment,{children:e.jsxs(n,{bg:"white",width:"100%",overflowY:"auto",borderRadius:"6px",px:3,py:2,direction:"column",children:[e.jsxs(n,{mb:2,justifyContent:"space-between",borderBottom:"2px",borderColor:"gray.200",children:[e.jsx(y,{fontSize:["18px","18px","22px","22px"],as:"h3",size:"md",color:"gray.600",mb:4,children:"Upload Template Excel"}),e.jsxs(m,{onClick:()=>{d(0)},size:"sm",colorScheme:"blackAlpha",children:[e.jsx(i,{icon:q})," Kembali"]})]}),f?e.jsx(e.Fragment,{children:e.jsxs(n,{direction:"column",py:2,children:[e.jsxs(n,{justifyContent:"space-between",my:2,children:[e.jsx(y,{as:"h3",size:"sm",mb:2,color:"gray.700",children:"Review Data Upload"}),e.jsxs(m,{onClick:_,colorScheme:"blue",size:"sm",children:["Simpan"," ",F?e.jsxs(e.Fragment,{children:[" "," ",e.jsx(i,{icon:w,spin:!0})]}):""]})]}),e.jsx(D,{width:"100%",overflowY:"auto",children:e.jsxs(B,{variant:"simple",size:"sm",children:[e.jsx(N,{children:e.jsxs(p,{children:[e.jsx(o,{children:"No."}),e.jsx(o,{children:"Nama"}),e.jsxs(o,{children:["Hadir ",e.jsx("br",{}),"Lama"," ",e.jsx(i,{icon:x})," ","Baru"]}),e.jsxs(o,{children:["Terlambat ",e.jsx("br",{}),"Lama"," ",e.jsx(i,{icon:x})," ","Baru"]}),e.jsxs(o,{children:["Tidak Hadir ",e.jsx("br",{}),"Lama"," ",e.jsx(i,{icon:x})," ","Baru"]})]})}),e.jsx(E,{children:k.length<1?e.jsx(p,{children:e.jsx(a,{colSpan:5,children:e.jsx(C,{})})}):k.map((s,r)=>e.jsxs(p,{children:[e.jsx(a,{children:r+1}),e.jsx(a,{children:s.fullname}),e.jsxs(a,{isNumeric:!0,children:[s.absensi.hadir,"%"," ",e.jsx(i,{icon:x,style:{color:s.renew?"orange":"gray"}})," ",s.absensi_new.hadir,"%"]}),e.jsxs(a,{isNumeric:!0,children:[s.absensi.terlambat,"%"," ",e.jsx(i,{icon:x,style:{color:s.renew?"orange":"gray"}})," ",s.absensi_new.terlambat,"%"]}),e.jsxs(a,{isNumeric:!0,children:[s.absensi.tidak_hadir,"%"," ",e.jsx(i,{icon:x,style:{color:s.renew?"orange":"gray"}})," ",s.absensi_new.tidak_hadir,"%"]})]},r))})]})}),e.jsx(n,{width:"100%",justifyContent:"flex-end",mt:"20px",children:e.jsxs(m,{onClick:_,colorScheme:"blue",size:"sm",children:["Simpan"," ",F?e.jsxs(e.Fragment,{children:[" "," ",e.jsx(i,{icon:w,spin:!0})]}):""]})})]})}):e.jsxs(e.Fragment,{children:[e.jsx(n,{color:"gray.600",fontSize:"13px",alignItems:"center",justifyContent:"flex-end",mb:2,cursor:"pointer",onClick:K,children:e.jsxs(n,{alignItems:"center",width:"max-content",bg:"gray.600",color:"white",fontWeight:"bold",px:3,py:1,borderRadius:"16px",children:[b?"Sembunyikan":"Upload File"," "," ",e.jsx(i,{style:{color:"white",transform:b?"rotate(180deg)":"rotate(0deg)",transitionDelay:"1s",transition:"350ms ease-out"},icon:M})]})}),e.jsxs(n,{direction:"column",minHeight:b?"200px":"0px",maxHeight:b?"200px":"0px",overflow:"hidden",transition:"500ms ease-out",mb:3,children:[e.jsxs(n,{width:"100%",direction:"column",children:[e.jsx("input",{type:"file",onChange:s=>{const r=s.target.files[0];I(r)}}),e.jsxs("aside",{style:{marginTop:"10px",display:"flex",flexDirection:"column"},children:[e.jsx("h4",{style:{fontSize:"14px",color:"#4a5568",fontWeight:"bold"},children:"Informasi File"}),e.jsx("ul",{style:{fontSize:"12px",color:"#4a5568"},children:j===null?e.jsx("li",{children:"Upload File!"}):e.jsx(e.Fragment,{children:j.name})})]})]}),e.jsxs(n,{direction:["column","column","row","row"],alignItems:["flex-end","flex-end","center","center"],bg:"gray.100",borderBottom:"2px",borderBottomColor:"gray.400",px:3,pt:1,borderRadius:"6px",mt:1,children:[e.jsx(n,{fontWeight:"bold",fontSize:["14px","14px","15px","15px"],children:"Unduh Template"}),e.jsxs(n,{children:[e.jsxs(m,{variant:"ghost",colorScheme:"blue",as:"a",href:"/sik/get-template-absensi",ml:[0,0,3,3],size:"sm",children:["Dosen  ",e.jsx(i,{icon:A})]}),e.jsxs(m,{variant:"ghost",colorScheme:"blue",as:"a",href:"/sik/get-template-absensi/tendik",ml:3,size:"sm",children:["Tendik  ",e.jsx(i,{icon:A})]})]})]}),e.jsx(n,{mt:2,children:e.jsxs(m,{width:"100%",colorScheme:"green",onClick:P,isDisabled:j===null,children:["Upload",Y?e.jsxs(e.Fragment,{children:[" "," ",e.jsx(i,{icon:w,spin:!0})]}):e.jsxs(e.Fragment,{children:[" "," ",e.jsx(i,{icon:Q,bounce:j!==null})]})]})})]}),e.jsxs(n,{justifyContent:"space-between",mb:1,alignItems:"flex-end",children:[e.jsx(y,{as:"h3",size:"sm",mb:2,color:"gray.700",children:"Data Absensi Saat Ini"}),e.jsxs(n,{lineHeight:"1.1em",fontWeight:"bold",direction:"column",alignItems:"flex-end",children:[e.jsx(n,{fontSize:["12px","12px","13px","13px"],children:"Terakhir Diperbarui"}),e.jsx(n,{fontSize:["11px","11px","12px","12px"],color:"gray.500",children:L})]})]}),e.jsx(D,{width:"100%",overflowY:"auto",children:e.jsxs(B,{variant:"simple",size:"sm",children:[e.jsx(N,{children:e.jsxs(p,{children:[e.jsx(o,{children:"No."}),e.jsx(o,{children:"Nama"}),e.jsx(o,{children:"Hadir"}),e.jsx(o,{children:"Terlambat"}),e.jsx(o,{children:"Tidak Hadir"})]})}),e.jsx(E,{children:h.length<1?e.jsx(p,{children:e.jsx(a,{colSpan:5,children:e.jsx(C,{})})}):h.map((s,r)=>e.jsxs(p,{children:[e.jsx(a,{children:r+1}),e.jsx(a,{children:s.fullname}),e.jsxs(a,{isNumeric:!0,children:[s.absensi.hadir,"%"]}),e.jsxs(a,{isNumeric:!0,children:[s.absensi.terlambat,"%"]}),e.jsxs(a,{isNumeric:!0,children:[s.absensi.tidak_hadir,"%"]})]}))})]})})," "]})]})})};export{me as default};
