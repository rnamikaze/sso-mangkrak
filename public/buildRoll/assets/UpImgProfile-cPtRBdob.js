import{r,j as e,S as K}from"./app-B5JuA1cy.js";import{F as B}from"./index.es-C_U1UPVr.js";import{H as O}from"./index-CevUe-Si.js";import{b as V}from"./index-DjOUsMDD.js";import{F as x}from"./flex-D7MDlKee.js";import{I as S}from"./image-DpVgwKji.js";import{C as Y}from"./circular-progress-CHKMyF6u.js";import{C as q}from"./circular-progress-label-Dd2r8Jn8.js";import{T as D}from"./text-vcTeec7L.js";import{B as Q}from"./button-DOH4T2Pi.js";import"./use-image-B67VQl14.js";import"./use-merge-refs-BMyyYqY7.js";import"./attr-sHTFgF0E.js";function X(l){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let p="";for(let i=0;i<l;i++){const c=Math.floor(Math.random()*n.length);p+=n.charAt(c)}return p}function Z(){const l=new Date,n=l.getFullYear();let p=l.getMonth()+1,i=l.getDate();return p<10&&(p="0"+p),i<10&&(i="0"+i),n+"-"+p+"-"+i}function L(l){return l.slice((l.lastIndexOf(".")-1>>>0)+2)}const de=({mainTheme:l,editMode:n,selectedDataPegawai:p,pfImgLoaded:i,setPfImgLoaded:c,values:m,setValues:_,previewPath:k,setPreviewPath:b})=>{const[o,F]=r.useState({id:n?p[0].id:null,img_profile:null,saveName:null,saveBefore:null,initial:m.initial}),[d,R]=r.useState(null),[ee,T]=r.useState(n?p[0].profile_img_path:null),[y,u]=r.useState(0),[E,v]=r.useState(!1),[N,I]=r.useState(!1);r.useState(!1);const[$,w]=r.useState(!1),[z,P]=r.useState(1),[U,j]=r.useState(null),h="PROFILE_IMG_NAME",W=async a=>{a.preventDefault();try{const t=new FormData;t.append("img_profile",o.img_profile),t.append("id",o.id),t.append("saveName",o.saveName),t.append("saveBefore",o.saveBefore),t.append("initial",o.initial);const g=o.initial==="sso"?"/save-profile-image":"/sik/save-profile-image",s=await axios.post(g,t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:f=>{const C=Math.round(f.loaded/f.total*100);u(C)}});T(s.data.img_storage_path),P(f=>f+=1),u(0)}catch(t){console.error("Error uploading file:",t)}},H=()=>{I(!0),setTimeout(()=>{I(!1)},1e3)},M=async a=>{a.preventDefault();try{const t=new FormData;t.append("img_profile",o.img_profile),t.append("id",o.id),t.append("saveName",o.saveName),t.append("saveBefore",o.saveBefore),t.append("initial",o.initial);const s=await axios.post("/sik/save-profile-image-temp",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:f=>{const C=Math.round(f.loaded/f.total*100);u(C)}});b(s.data.img_storage_path),u(0),v(!1),w(!1),H()}catch(t){console.error("Error uploading file:",t)}},G=a=>{const t=a.target.files[0];if(t&&A(t)&&J(t)){v(!0);let g="";F(s=>({...s,saveBefore:localStorage.getItem(h)!==null?localStorage.getItem(h):null})),F(s=>({...s,img_profile:t})),n===!1&&setTimeout(()=>{g=Z()+X(10)+"."+L(t.name),localStorage.setItem(h,g),_(s=>({...s,imgFile:o})),F(s=>({...s,saveName:localStorage.getItem(h)})),_(s=>({...s,imgTemp:localStorage.getItem(h)}))},1e3),w(!0)}else alert("Tipe file salah atau ukuran terlalu besar !")},A=a=>{const t=["image/jpeg","image/png","image/jpg"];return t.includes(a.type)||t.some(g=>a.name.endsWith(g.split("/")[1]))},J=a=>a.size<=2097152;return r.useEffect(()=>{c(!1),n&&(b(`/storage/profile/${m.nik}/${d}`),d?axios.post("/sik/check-image-exist",{filePath:`profile/${m.nik}/${d}`}).then(function(a){c(!0),a.data.good?j(`/storage/profile/${m.nik}/${d}`):j("https://storage.unusida.id/storage/images/no-image-placeholder.png")}).catch(function(a){}):(i===!1&&j("https://storage.unusida.id/storage/images/no-image-placeholder.png"),c(!0)))},[d]),r.useEffect(()=>{R(n?p[0].img_storage:null)},[]),r.useEffect(()=>{z>1&&(c(!1),axios.post("/sik/get-img-storage",{nik:m.nik}).then(function(a){c(!0),b(`/storage/profile/${m.nik}/${a.data.img_storage}`),j(`/storage/profile/${m.nik}/${a.data.img_storage}`)}).catch(function(a){}))},[z]),e.jsx("form",{onSubmit:n?W:M,children:e.jsxs(x,{width:"100%",justifyItems:"center",alignItems:["center","center","center","flex-end"],direction:["column","column","column","row"],children:[e.jsxs(x,{mx:5,mt:5,width:"150px",height:"max-content",px:1,py:1,borderRadius:"6px",border:"2px",borderColor:l.mainBg,alignItems:"center",justifyContent:"center",position:"relative",children:[n?e.jsx(e.Fragment,{children:e.jsx(S,{boxSize:"200px",htmlHeight:["150px","150px","150px","80%"],htmlWidth:"80%",objectFit:"cover",borderRadius:"6px",src:U,alt:"/"+p[0].fullname})}):e.jsx(e.Fragment,{children:N===!1?e.jsx(e.Fragment,{children:$?e.jsx(S,{boxSize:"200px",htmlHeight:["150px","150px","150px","80%"],htmlWidth:"80%",objectFit:"cover",borderRadius:"6px",src:"https://placehold.co/150x200",alt:"Foto Profil",onLoad:()=>{i===!1&&c(!0)}}):e.jsx(S,{boxSize:"200px",htmlHeight:["150px","150px","150px","80%"],htmlWidth:"80%",objectFit:"cover",borderRadius:"6px",src:k===null?"https://placehold.co/150x200":"/storage/temp/"+k,alt:"Foto Profil",onLoad:()=>{i===!1&&c(!0)}})}):e.jsx(S,{boxSize:"200px",htmlHeight:["150px","150px","150px","80%"],htmlWidth:"80%",objectFit:"cover",borderRadius:"6px",src:"https://placehold.co/150x200",alt:"Foto Profil",onLoad:()=>{i===!1&&c(!0)}})}),i===!1?e.jsx(x,{width:"100%",height:"100%",alignItems:"center",justifyContent:"center",position:"absolute",top:"0px",left:"0px",bg:"green.200",children:e.jsx(K,{size:"md",color:"white"})}):"",y===0?"":e.jsx(x,{position:"absolute",top:"0px",left:"0px",bg:"rgba(0, 0, 0, 0.6)",width:"100%",height:"100%",alignItems:"center",justifyContent:"center",children:e.jsx(Y,{value:y,color:"green.400",children:e.jsxs(q,{color:l.boxBg,children:[y,"%"]})})})]}),e.jsxs(x,{direction:"column",bg:"white",children:[o.img_profile===null?"":e.jsxs(D,{mt:2,fontSize:"12px",whiteSpace:"wrap",maxWidth:"150px",children:["File: ",o.img_profile.name," ",e.jsx("br",{}),"Ukuran:"," ",(o.img_profile.size/1e3).toFixed(2),"KB"]}),e.jsx("div",{style:{margin:"10px 0px 0px 0px",width:"150px",borderRadius:"6px"},class:"file is-small",children:e.jsxs("label",{class:"file-label",style:{width:"100%"},children:[e.jsx("input",{class:"file-input",type:"file",onChange:G}),e.jsxs("span",{style:{width:"100%",display:"flex",justifyContent:"center"},class:"file-cta",children:[e.jsx("span",{class:"file-icon",children:e.jsx(B,{icon:V})}),e.jsx("span",{class:"file-label",children:"Pilih File "})]})]})}),e.jsxs(D,{color:l.text,mt:4,fontSize:"12px",children:["Format: PNG, JPG, JPEG ",e.jsx("br",{}),"Ukuran Maksimal: 2MB"]}),e.jsxs(Q,{mt:2,width:"100%",type:"submit",colorScheme:"green",isDisabled:!E,children:[e.jsx(B,{icon:O}),"  Upload"]})]})]})})};export{de as default};
