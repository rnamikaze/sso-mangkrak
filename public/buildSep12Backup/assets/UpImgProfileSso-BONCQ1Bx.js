import{r as i,j as e,S as K}from"./app-D-tiouko.js";import{F as B}from"./index.es-B8LRRmtI.js";import{H as O}from"./index-BLEpFBfl.js";import{b as V}from"./index-B2KZh1O9.js";import{F as u}from"./flex-B3u7Yjy3.js";import{I as b}from"./image-ChnvBbJV.js";import{C as Y}from"./circular-progress-CsYzCqAF.js";import{C as q}from"./circular-progress-label-DHR4Ff0c.js";import{T as D}from"./text-B41xTBOs.js";import{B as Q}from"./button-b_OXMfTF.js";import"./use-image-B_C2-tJP.js";import"./use-merge-refs-BFB3bSvN.js";import"./attr-sHTFgF0E.js";function X(l){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let p="";for(let s=0;s<l;s++){const c=Math.floor(Math.random()*n.length);p+=n.charAt(c)}return p}function Z(){const l=new Date,n=l.getFullYear();let p=l.getMonth()+1,s=l.getDate();return p<10&&(p="0"+p),s<10&&(s="0"+s),n+"-"+p+"-"+s}function L(l){return l.slice((l.lastIndexOf(".")-1>>>0)+2)}const de=({mainTheme:l,editMode:n,selectedDataPegawai:p,pfImgLoaded:s,setPfImgLoaded:c,values:m,setValues:_,previewPath:v,setPreviewPath:S})=>{const[o,F]=i.useState({id:n?p[0].id:null,img_profile:null,saveName:null,saveBefore:null,initial:m.initial}),[d,E]=i.useState(null),[ee,R]=i.useState(n?p[0].profile_img_path:null),[y,x]=i.useState(0),[T,I]=i.useState(!1),[N,k]=i.useState(!1);i.useState(!1);const[$,w]=i.useState(!1),[z,P]=i.useState(1),[U,j]=i.useState(null),h="PROFILE_IMG_NAME",W=async a=>{a.preventDefault();try{const t=new FormData;t.append("img_profile",o.img_profile),t.append("id",o.id),t.append("saveName",o.saveName),t.append("saveBefore",o.saveBefore),t.append("initial",o.initial);const f=o.initial==="sso"?"/save-profile-image":"/sik/save-profile-image",r=await axios.post(f,t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:g=>{const C=Math.round(g.loaded/g.total*100);x(C)}});R(r.data.img_storage_path),P(g=>g+=1),x(0)}catch(t){console.error("Error uploading file:",t)}},H=()=>{k(!0),setTimeout(()=>{k(!1)},1e3)},M=async a=>{a.preventDefault();try{const t=new FormData;t.append("img_profile",o.img_profile),t.append("id",o.id),t.append("saveName",o.saveName),t.append("saveBefore",o.saveBefore),t.append("initial",o.initial);const r=await axios.post("/sik/save-profile-image-temp",t,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:g=>{const C=Math.round(g.loaded/g.total*100);x(C)}});S(r.data.img_storage_path),x(0),I(!1),w(!1),H()}catch(t){console.error("Error uploading file:",t)}},G=a=>{const t=a.target.files[0];if(t&&A(t)&&J(t)){I(!0);let f="";F(r=>({...r,saveBefore:localStorage.getItem(h)!==null?localStorage.getItem(h):null})),F(r=>({...r,img_profile:t})),n===!1&&setTimeout(()=>{f=Z()+X(10)+"."+L(t.name),localStorage.setItem(h,f),_(r=>({...r,imgFile:o})),F(r=>({...r,saveName:localStorage.getItem(h)})),_(r=>({...r,imgTemp:localStorage.getItem(h)}))},1e3),w(!0)}else alert("Tipe file salah atau ukuran terlalu besar !")},A=a=>{const t=["image/jpeg","image/png","image/jpg"];return t.includes(a.type)||t.some(f=>a.name.endsWith(f.split("/")[1]))},J=a=>a.size<=2097152;return i.useEffect(()=>{c(!1),n&&(S(`/storage/profile/${m.nik}/${d}`),d?axios.post("/sso/check-image-exist",{filePath:`profile/${m.nik}/${d}`}).then(function(a){c(!0),a.data.good?j(`/storage/profile/${m.nik}/${d}`):j("https://storage.unusida.id/storage/images/no-image-placeholder.png")}).catch(function(a){}):(s===!1&&j("https://storage.unusida.id/storage/images/no-image-placeholder.png"),c(!0)))},[d]),i.useEffect(()=>{E(n?p[0].img_storage:null)},[]),i.useEffect(()=>{z>1&&(c(!1),axios.post("/sso/get-img-storage",{nik:m.nik}).then(function(a){c(!0),S(`/storage/profile/${m.nik}/${a.data.img_storage}`),j(`/storage/profile/${m.nik}/${a.data.img_storage}`)}).catch(function(a){}))},[z]),i.useEffect(()=>{},[]),e.jsx("form",{onSubmit:n?W:M,children:e.jsxs(u,{width:"100%",justifyItems:"center",alignItems:["center","center","center","flex-end"],direction:["column","column","column","row"],children:[e.jsxs(u,{mx:5,mt:5,width:"150px",height:"max-content",px:1,py:1,borderRadius:"6px",border:"2px",borderColor:l.mainBg,alignItems:"center",justifyContent:"center",position:"relative",children:[n?e.jsx(e.Fragment,{children:e.jsx(b,{boxSize:"200px",htmlHeight:["150px","150px","150px","80%"],htmlWidth:"80%",objectFit:"cover",borderRadius:"6px",src:U,alt:"/"+p[0].fullname})}):e.jsx(e.Fragment,{children:N===!1?e.jsx(e.Fragment,{children:$?e.jsx(b,{boxSize:"200px",htmlHeight:["150px","150px","150px","80%"],htmlWidth:"80%",objectFit:"cover",borderRadius:"6px",src:"https://placehold.co/150x200",alt:"Foto Profil",onLoad:()=>{s===!1&&c(!0)}}):e.jsx(b,{boxSize:"200px",htmlHeight:["150px","150px","150px","80%"],htmlWidth:"80%",objectFit:"cover",borderRadius:"6px",src:v===null?"https://placehold.co/150x200":"/storage/temp/"+v,alt:"Foto Profil",onLoad:()=>{s===!1&&c(!0)}})}):e.jsx(b,{boxSize:"200px",htmlHeight:["150px","150px","150px","80%"],htmlWidth:"80%",objectFit:"cover",borderRadius:"6px",src:"https://placehold.co/150x200",alt:"Foto Profil",onLoad:()=>{s===!1&&c(!0)}})}),s===!1?e.jsx(u,{width:"100%",height:"100%",alignItems:"center",justifyContent:"center",position:"absolute",top:"0px",left:"0px",bg:"green.200",children:e.jsx(K,{size:"md",color:"white"})}):"",y===0?"":e.jsx(u,{position:"absolute",top:"0px",left:"0px",bg:"rgba(0, 0, 0, 0.6)",width:"100%",height:"100%",alignItems:"center",justifyContent:"center",children:e.jsx(Y,{value:y,color:"green.400",children:e.jsxs(q,{color:l.boxBg,children:[y,"%"]})})})]}),e.jsxs(u,{direction:"column",bg:"white",children:[o.img_profile===null?"":e.jsxs(D,{mt:2,fontSize:"12px",whiteSpace:"wrap",maxWidth:"150px",children:["File: ",o.img_profile.name," ",e.jsx("br",{}),"Ukuran:"," ",(o.img_profile.size/1e3).toFixed(2),"KB"]}),e.jsx("div",{style:{margin:"10px 0px 0px 0px",width:"150px",borderRadius:"6px"},class:"file is-small",children:e.jsxs("label",{class:"file-label",style:{width:"100%"},children:[e.jsx("input",{class:"file-input",type:"file",onChange:G}),e.jsxs("span",{style:{width:"100%",display:"flex",justifyContent:"center"},class:"file-cta",children:[e.jsx("span",{class:"file-icon",children:e.jsx(B,{icon:V})}),e.jsx("span",{class:"file-label",children:"Pilih File "})]})]})}),e.jsxs(D,{color:l.text,mt:4,fontSize:"12px",children:["Format: PNG, JPG, JPEG ",e.jsx("br",{}),"Ukuran Maksimal: 2MB"]}),e.jsxs(Q,{mt:2,width:"100%",type:"submit",colorScheme:"green",isDisabled:!T,children:[e.jsx(B,{icon:O}),"  Upload"]})]})]})})};export{de as default};
