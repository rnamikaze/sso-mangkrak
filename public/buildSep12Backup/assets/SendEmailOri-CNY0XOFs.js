import{r as a,j as e}from"./app-D-tiouko.js";import I from"./PdfTwo-CoJGdWMw.js";import{F as x}from"./index.es-B8LRRmtI.js";import{f as b}from"./index-BLEpFBfl.js";import{B as P,b as z}from"./PDFOnly-BMzVfqlE.js";import{F as s}from"./flex-B3u7Yjy3.js";import{B as g}from"./button-b_OXMfTF.js";import{T as M}from"./text-B41xTBOs.js";import"./server.browser-CdZao9Hd.js";import"./typeof-BVQB8lKn.js";import"./logo_unu_primary_green_small-hbguD8Ld.js";import"./use-merge-refs-BFB3bSvN.js";import"./attr-sHTFgF0E.js";const $=({actualData:m,filename:W,setActiveView:j,arrLog:w,pushArrLog:y,clearArrLog:_,passerData:p})=>{const[d,u]=a.useState(!1),[S,f]=a.useState(0),[l,B]=a.useState([]),[k,D]=a.useState(!1),[F,K]=a.useState(null),v=(o,n,t,r,h,T,C,O)=>{const i=new FormData;return i.append("file",o),i.append("name",n),i.append("email",t),i.append("bank_rek",h),i.append("no_rek",T),i.append("no",r),i.append("jabatan",C),axios.post("/aslip/send-mail",i,{headers:{"Content-Type":"multipart/form-data"}}).then(c=>c.data).catch(c=>{throw console.error(c),c})},E=async()=>{let o=!1,n=0;u(!0);for(const t of m)if(!o)try{const r=await R(t);(await v(r,t.rn_nama_karyawan,t.rn_email,t.rn_no,t.rn_nama_buku_tabungan,t.rn_no_rek,t.rn_jabatan,n)).status===500&&(console.error("Received status 500, stopping iteration."),o=!0),n++,y(t.rn_email),n===m.length?setTimeout(()=>{u(!1),f(0)},3e3):n<m.length&&f(n)}catch(r){console.error(r)}},R=async o=>new Promise((n,t)=>{P({document:e.jsx(z,{targetData:o})}).toBlob().then(r=>n(r)).catch(r=>t(r))});a.useEffect(()=>{B(p)},[p]),a.useEffect(()=>{},[F]),a.useEffect(()=>{setTimeout(()=>{D(!0)},1500)},[]);try{return e.jsx(e.Fragment,{children:l!==void 0&&l.length>0?e.jsxs(s,{width:"77vw",height:"max-content",borderRadius:"15px",bg:"white",px:4,pt:1,pb:4,direction:"column",position:"relative",children:[e.jsx(I,{targetData:l[S],incrementBtn:null,decrementBtn:null,formatedData:l}),k===!1?e.jsxs(s,{top:"0px",left:"0px",position:"absolute",width:"100%",height:"100%",bg:"#38a169ac",zIndex:50,borderRadius:"15px",alignItems:"center",justifyContent:"center",color:"white",fontWeight:"bold",letterSpacing:"2px",children:[e.jsx(x,{icon:b,spin:!0}),"   Menyiapkan..."]}):"",e.jsxs(s,{mb:3,position:"relative",justifyContent:"space-between",children:[e.jsxs(s,{children:[e.jsx(g,{colorScheme:"red",width:"max-content",onClick:()=>{setTimeout(()=>{E()},500)},isDisabled:d,size:"sm",children:"Mulai Kirim Email"}),e.jsx(g,{colorScheme:"green",width:"max-content",onClick:()=>{j(0),_()},ml:2,size:"sm",children:"Kembali"})]}),d?e.jsxs(s,{ml:2,color:"#2f2f2f",fontWeight:"bold",px:3,alignItems:"center",bg:"blue.100",children:["Mengirim",e.jsx(x,{icon:b,spin:!0})]}):""]}),e.jsx(M,{fontSize:"20px",fontWeight:"bold",children:"Log:"}),e.jsxs(s,{bg:"black",borderRadius:"6px",width:"100%",height:"max-content",color:"white",px:3,py:2,direction:"column",children:["... ",e.jsx("br",{}),w.map((o,n)=>e.jsx(s,{direction:"column",children:o},n))]})]}):""})}catch{return e.jsx(s,{color:"white",children:"Hehe"})}};export{$ as default};
